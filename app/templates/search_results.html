{% extends "base.html" %}

{% block content %}
<div class="container">
    {% if query %}
        <h1>Search Results for "{{ query }}"</h1>
    {% else %}
        <h1>Search</h1>
        <p>Please enter a term to search for.</p>
    {% endif %}

    {% if users or posts or groups %}
        {% if users %}
            <h2>Users Found ({{ users|length }})</h2>
            <ul class="list-group mb-3">
                {% for user in users %}
                    <li class="list-group-item">
                        <a href="{{ url_for('main.profile', username=user.username) }}">
                            <img src="{{ url_for('static', filename='images/' + user.profile_picture_url) }}" alt="{{ user.username }}'s profile picture" class="rounded-circle mr-2" width="30" height="30" style="margin-right: 5px;"> {# Added inline style for margin #}
                            {{ user.username }}
                        </a>
                        {% if user.bio %}
                            <small class="text-muted d-block mt-1">{{ user.bio[:100] }}{% if user.bio|length > 100 %}...{% endif %}</small>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% endif %}

        {% if posts %}
            <h2>Posts Found ({{ posts|length }})</h2>
            {% for post in posts %}
                {# Assuming _post.html can handle not having comment_form passed,
                   or we pass a new CommentForm instance if needed by _post.html.
                   The current _post.html has `{% if comment_form %}` check. #}
                {% include "_post.html" %}
            {% endfor %}
        {% endif %}

        {% if groups %}
            <h2>Groups Found ({{ groups|length }})</h2>
            <ul class="list-group mb-3">
                {% for group in groups %}
                    <li class="list-group-item">
                        <a href="{{ url_for('main.view_group', group_id=group.id) }}">
                            <img src="{{ url_for('static', filename='group_images/' + group.image_file) if group.image_file else url_for('static', filename='group_images/default_group_pic.png') }}" alt="{{ group.name }}'s image" class="rounded-circle mr-2" width="30" height="30" style="margin-right: 5px;">
                            {{ group.name }}
                        </a>
                        {% if group.description %}
                            <small class="text-muted d-block mt-1">{{ group.description[:100] }}{% if group.description|length > 100 %}...{% endif %}</small>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    {% elif query %}
        {# This means query was provided but no users, posts or groups were found #}
        <p>No users, posts, or groups found matching your query "{{ query }}".</p>
    {% endif %}
</div>
{% endblock content %}
